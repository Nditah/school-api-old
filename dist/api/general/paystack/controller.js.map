{"version":3,"sources":["../../../../src/api/general/paystack/controller.js"],"names":["req","res","payload","body","options","method","uri","transUrl","headers","headersObj","auth","bearer","secretKey","json","then","status","data","message","catch","error","checkAuthorization","id","params","getTransaction","timelineTransaction","perPage","page","customer","from","to","amount","console","log","listTransaction","reference","verifyTransaction","verifyPaystack","totalTransaction","Accept","publicKey","process","env","PAYSTACK_TEST_PUBLIC_KEY","PAYSTACK_TEST_SECRET_KEY"],"mappings":"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","file":"controller.js","sourcesContent":["import rp from \"request-promise\";\nimport { success, fail } from \"../../../lib\";\n\nconst transUrl = \"https://api.paystack.co/transaction\"; // list\n// const verifyUrl = \"/verify/reference\";\n// Fetch https://api.paystack.co/transaction/id\n// Transaction Totals https://api.paystack.co/transaction/totals\n// Export Transactions: https://api.paystack.co/transaction/export\n// Check Authorization: https://api.paystack.co/transaction/check_authorization\n\nconst headersObj = {\n    Accept: \"application/json\",\n    \"Content-Type\": \"application/json\",\n    json: true,\n};\n\nconst publicKey = process.env.PAYSTACK_TEST_PUBLIC_KEY;\nconst secretKey = process.env.PAYSTACK_TEST_SECRET_KEY;\n/*\nif (process.env.NODE_ENV === \"production\") {\n    publicKey = process.env.PAYSTACK_LIVE_PUBLIC_KEY;\n    secretKey = process.env.PAYSTACK_LIVE_SECRET_KEY;\n// tnxHash = process.env.FLUTTERWAVE_HASH;\n}\n*/\n\nexport async function checkAuthorization(req, res) {\n    const payload = req.body;\n    const options = {\n        method: \"POST\",\n        uri: `${transUrl}/check_authorization`,\n        body: payload,\n        headers: headersObj,\n        auth: { bearer: secretKey },\n        json: true, // Automatically stringifies the body to JSON\n    };\n    return rp(options).then((body) => {\n        if (body.status) return success(res, 200, body.data, body.message);\n        return fail(res, 200, body.message);\n    }).catch((error) => {\n        fail(res, 500, `Error checking Auth. ${error.message}`);\n    });\n}\n\nexport async function getTransaction(req, res) {\n    const { id } = req.params;\n    const options = {\n        method: \"GET\",\n        uri: `${transUrl}/${id}`,\n        headers: headersObj,\n        auth: { bearer: secretKey },\n        json: true,\n    };\n    return rp(options).then((body) => {\n        if (body.status) return success(res, 200, body.data, body.message);\n        return fail(res, 200, body.message);\n    }).catch((error) => {\n        fail(res, 500, `Error getting Tnx. ${error.message}`);\n    });\n}\n\nexport async function timelineTransaction(req, res) {\n    const { id } = req.params;\n    const options = {\n        method: \"GET\",\n        uri: `${transUrl}/timeline/${id}`,\n        auth: { bearer: secretKey },\n        headers: headersObj,\n        json: true, // Automatically stringifies the body to JSON\n    };\n    return rp(options).then((body) => {\n        if (body.status) return success(res, 200, body.data, body.message);\n        return fail(res, 200, body.message);\n    }).catch((error) => {\n        fail(res, 500, `Error getting timeline. ${error.message}`);\n    });\n}\n\n// eslint-disable-next-line complexity\nexport async function listTransaction(req, res) {\n    const { perPage, page, customer, status, from, to, amount } = req.body;\n    const payload = {};\n    if (perPage) payload.perPage = perPage;\n    if (page) payload.page = page;\n    if (customer) payload.customer = customer;\n    if (status) payload.status = status;\n    if (from) payload.from = from;\n    if (to) payload.to = to;\n    if (amount) payload.amount = amount;\n\n    console.log(\"query options\", payload);\n    const options = {\n        method: \"GET\",\n        uri: `${transUrl}`,\n        body: payload,\n        headers: headersObj,\n        auth: { bearer: secretKey },\n        json: true, // Automatically stringifies the body to JSON\n    };\n    return rp(options).then((body) => {\n        if (body.status) return success(res, 200, body.data, body.message);\n        return fail(res, 200, body.message);\n    }).catch((error) => {\n        fail(res, 500, `Error listing Tnx. ${error.message}`);\n    });\n}\n\nexport async function verifyTransaction(req, res) {\n    const { reference } = req.params;\n    const options = {\n        method: \"GET\",\n        uri: `${transUrl}/verify/${reference}`,\n        headers: headersObj,\n        auth: { bearer: secretKey },\n        json: true, // Automatically stringifies the body to JSON\n    };\n    return rp(options).then((body) => {\n        if (body.status) return success(res, 200, body.data, body.message);\n        return fail(res, 200, body.message);\n    }).catch((error) => {\n        fail(res, 500, `Error list Tnx. ${error.message}`);\n    });\n}\n\nexport async function verifyPaystack(reference) {\n    const options = {\n        method: \"GET\",\n        uri: `${transUrl}/verify/${reference}`,\n        headers: headersObj,\n        auth: { bearer: secretKey },\n        json: true, // Automatically stringifies the body to JSON\n    };\n    return rp(options).then(body => body).catch(error => error);\n}\n\nexport async function totalTransaction(req, res) {\n    const { from, to } = req.params;\n    const options = {\n        method: \"GET\",\n        uri: `${transUrl}/totals`,\n        body: { from, to },\n        headers: headersObj,\n        auth: { bearer: secretKey },\n        json: true, // Automatically stringifies the body to JSON\n    };\n    return rp(options).then((body) => {\n        if (body.status) return success(res, 200, body.data, body.message);\n        return fail(res, 200, body.message);\n    }).catch((error) => {\n        fail(res, 500, `Error getting total Tnx. ${error.message}`);\n    });\n}\n"]}